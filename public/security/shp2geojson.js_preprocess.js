var geojsonData={};SHP={NULL:0,POINT:1,POLYLINE:3,POLYGON:5},SHP.getShapeName=function(e){for(name in this)if(e===this[name])return name},SHPParser=function(){},SHPParser.load=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.onload=function(){geojsonData["shp"]=(new SHPParser).parse(r.response,e),t(geojsonData["shp"],n),URL.revokeObjectURL(e)},r.onerror=onerror,r.send(null)},SHPParser.prototype.parse=function(e,t){var n={},r=new DataView(e),a=0;if(n.fileName=t,n.fileCode=r.getInt32(a,!1),9994!=n.fileCode)throw new Error("Unknown file code: "+n.fileCode);a+=24,n.wordLength=r.getInt32(a,!1),n.byteLength=2*n.wordLength,a+=4,n.version=r.getInt32(a,!0),a+=4,n.shapeType=r.getInt32(a,!0),a+=4,n.minX=r.getFloat64(a,!0),n.minY=r.getFloat64(a+8,!0),n.maxX=r.getFloat64(a+16,!0),n.maxY=r.getFloat64(a+24,!0),n.minZ=r.getFloat64(a+32,!0),n.maxZ=r.getFloat64(a+40,!0),n.minM=r.getFloat64(a+48,!0),n.maxM=r.getFloat64(a+56,!0),a+=64,n.records=[];while(a<n.byteLength){var o={};o.number=r.getInt32(a,!1),a+=4,o.length=r.getInt32(a,!1),a+=4;try{o.shape=this.parseShape(r,a,o.length)}catch(s){}a+=2*o.length,n.records.push(o)}return n},SHPParser.prototype.parseShape=function(e,t,n){var r=0,a=null,o={};o.type=e.getInt32(t,!0),t+=4;switch(o.type){case SHP.NULL:break;case SHP.POINT:o.content={x:e.getFloat64(t,!0),y:e.getFloat64(t+8,!0)};break;case SHP.POLYLINE:case SHP.POLYGON:for(a=o.content={minX:e.getFloat64(t,!0),minY:e.getFloat64(t+8,!0),maxX:e.getFloat64(t+16,!0),maxY:e.getFloat64(t+24,!0),parts:new Int32Array(e.getInt32(t+32,!0)),points:new Float64Array(2*e.getInt32(t+36,!0))},t+=40,r=0;r<a.parts.length;r++)a.parts[r]=e.getInt32(t,!0),t+=4;for(r=0;r<a.points.length;r++)a.points[r]=e.getFloat64(t,!0),t+=8;break;case 8:case 11:case 13:case 15:case 18:case 21:case 23:case 25:case 28:case 31:throw new Error("Shape type not supported: "+o.type+":"+ +SHP.getShapeName(o.type));default:throw new Error("Unknown shape type at "+(t-4)+": "+o.type)}return o},DBF={},DBFParser=function(){},DBFParser.load=function(e,t,n,r){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="arraybuffer",a.onload=function(){var o=new XMLHttpRequest;o.open("GET",e),o.overrideMimeType("text/plain; charset="+t),o.onload=function(){geojsonData["dbf"]=(new DBFParser).parse(a.response,e,o.responseText,t),n(geojsonData["dbf"],r),URL.revokeObjectURL(e)},o.send()},a.onerror=onerror,a.send(null)},DBFParser.prototype.parse=function(e,t,n,r){var a={},o=new DataView(e),s=0,p=r.match(/big5/i)?2:3;a.fileName=t,a.version=o.getInt8(s,!1),s+=1,a.year=o.getUint8(s)+1900,s+=1,a.month=o.getUint8(s),s+=1,a.day=o.getUint8(s),s+=1,a.numberOfRecords=o.getInt32(s,!0),s+=4,a.bytesInHeader=o.getInt16(s,!0),s+=2,a.bytesInRecord=o.getInt16(s,!0),s+=2,s+=2,a.incompleteTransation=o.getUint8(s),s+=1,a.encryptionFlag=o.getUint8(s),s+=1,s+=4,s+=8,a.mdxFlag=o.getUint8(s),s+=1,a.languageDriverId=o.getUint8(s),s+=1,s+=2,a.fields=[];var i=n.split("\r");i.length>2?(i.pop(),responseHeader=i.join("\r"),responseHeader=responseHeader.slice(32,responseHeader.length)):(responseHeader=i[0],responseHeader=responseHeader.slice(32,responseHeader.length),p=2);var g=[],l=0,d=0;responseHeader.length;while(responseHeader.length>0){while(l<10)try{encodeURIComponent(responseHeader[m]).match(/%[A-F\d]{2}/g)&&encodeURIComponent(responseHeader[m]).match(/%[A-F\d]{2}/g).length>1?(l+=p,m++):(l+=1,m++)}catch(y){l+=1,m++}g.push(responseHeader.slice(0,10).replace(/\0/g,"")),responseHeader=responseHeader.slice(32,responseHeader.length)}while(1){for(var c={},h=[],f=0,m=0;f<10;f++){var u=o.getUint8(s);0!=u&&h.push(String.fromCharCode(u)),s+=1}c.name=g[d++],s+=1,c.type=String.fromCharCode(o.getUint8(s)),s+=1,s+=4,c.fieldLength=o.getUint8(s),s+=1,s+=1,s+=2,c.workAreaId=o.getUint8(s),s+=1,s+=2,c.setFieldFlag=o.getUint8(s),s+=1,s+=7,c.indexFieldFlag=o.getUint8(s),s+=1,a.fields.push(c);o.getUint8(s);if(13==o.getUint8(s))break}s+=1,a.fieldpos=s,a.records=[],responseText=n.split("\r")[n.split("\r").length-1];for(f=0;f<a.numberOfRecords;f++){responseText=responseText.slice(1,responseText.length);for(var F={},H=0;H<a.fields.length;H++){g=[],l=0,m=0;while(l<a.fields[H].fieldLength)try{encodeURIComponent(responseText[m]).match(/%[A-F\d]{2}/g)&&encodeURIComponent(responseText[m]).match(/%[A-F\d]{2}/g).length>1?(l+=p,m++,check=1):(l+=1,m++)}catch(y){l+=1,m++}g.push(responseText.slice(0,m).replace(/\0/g,"")),responseText=responseText.slice(m,responseText.length),g.join("").trim().match(/\d{1}\.\d{11}e\+\d{3}/g)?F[a.fields[H].name]=parseFloat(g.join("").trim()):F[a.fields[H].name]=g.join("").trim()}a.records.push(F)}return a};